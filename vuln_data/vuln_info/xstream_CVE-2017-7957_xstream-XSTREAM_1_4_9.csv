Vul_Path,Vul_Src
"xstream/src/test/com/thoughtworks/acceptance/SecurityVulnerabilityTest.java:[22,83]:SecurityVulnerabilityTest","public class SecurityVulnerabilityTest extends AbstractAcceptanceTest {

    private final static StringBuffer BUFFER = new StringBuffer();

    protected void setUp() throws Exception {
        super.setUp();
        BUFFER.setLength(0);
        xstream.alias(""runnable"", Runnable.class);
        xstream.allowTypes(new Class[]{EventHandler.class});
        xstream.allowTypeHierarchy(Runnable.class);
        xstream.addPermission(ProxyTypePermission.PROXIES);
    }

    public void testCannotInjectEventHandler() {
        final String xml = """"
                + ""<string class='runnable-array'>\n""
                + ""  <dynamic-proxy>\n""
                + ""    <interface>java.lang.Runnable</interface>\n""
                + ""    <handler class='java.beans.EventHandler'>\n""
                + ""      <target class='com.thoughtworks.acceptance.SecurityVulnerabilityTest$Exec'/>\n""
                + ""      <action>exec</action>\n""
                + ""    </handler>\n""
                + ""  </dynamic-proxy>\n""
                + ""</string>"";

        try {
            xstream.fromXML(xml);
            fail(""Thrown "" + XStreamException.class.getName() + "" expected"");
        } catch (final XStreamException e) {
            assertTrue(e.getMessage().indexOf(EventHandler.class.getName()) > 0);
        }
        assertEquals(0, BUFFER.length());
    }

    public void testExplicitlyConvertEventHandler() {
        final String xml = """"
                + ""<string class='runnable-array'>\n""
                + ""  <dynamic-proxy>\n""
                + ""    <interface>java.lang.Runnable</interface>\n""
                + ""    <handler class='java.beans.EventHandler'>\n""
                + ""      <target class='com.thoughtworks.acceptance.SecurityVulnerabilityTest$Exec'/>\n""
                + ""      <action>exec</action>\n""
                + ""    </handler>\n""
                + ""  </dynamic-proxy>\n""
                + ""</string>"";

        xstream.registerConverter(new ReflectionConverter(xstream.getMapper(), xstream
            .getReflectionProvider(), EventHandler.class));

        final Runnable[] array = (Runnable[])xstream.fromXML(xml);
        assertEquals(0, BUFFER.length());
        array[0].run();
        assertEquals(""Executed!"", BUFFER.toString());
    }

    public static class Exec {

        public void exec() {
            BUFFER.append(""Executed!"");
        }
    }
}
"
"xstream/src/java/com/thoughtworks/xstream/converters/reflection/SunLimitedUnsafeReflectionProvider.java:[74,92]:newInstance","    public Object newInstance(Class type) {
        if (exception != null) {
            ObjectAccessException ex = new ObjectAccessException(""Cannot construct type"", exception);
            ex.add(""construction-type"", type.getName());
            throw ex;
        }
        ErrorWritingException ex = null;
        try {
            return unsafe.allocateInstance(type);
        } catch (SecurityException e) {
            ex = new ObjectAccessException(""Cannot construct type"", e);
        } catch (InstantiationException e) {
            ex =  new ConversionException(""Cannot construct type"", e);
        } catch (IllegalArgumentException e) {
            ex = new ObjectAccessException(""Cannot construct type"", e);
        }
        ex.add(""construction-type"", type.getName());
        throw ex;
    }
"
"xstream/src/java/com/thoughtworks/xstream/security/PrimitiveTypePermission.java:[23,25]:allows","    public boolean allows(Class type) {
        return type != null && type.isPrimitive() || Primitives.isBoxed(type);
    }
"
